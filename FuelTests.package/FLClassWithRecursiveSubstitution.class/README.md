A test mock for a class with recursive substitution